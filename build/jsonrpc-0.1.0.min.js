JsonRpc=function(a){this._url=a,this._id=0},JsonRpc.prototype={call:function(){var a=this._getParams.apply(this,arguments);this._doJsonPost(this._url,a.request,function(b,c){b||(c={error:{message:c}}),b=b&&!c.error,c=b?c.result:c.error.message,b?a.success.call(a.scope,c):a.failure.call(a.scope,c),a.callback.call(a.scope,b,c)})},_getParams:function(){var a=Array.prototype.slice.call(arguments),b={request:{jsonrpc:"2.0",id:++this._id,method:a.shift()}};b.request.params=[];while(a.length>1&&!this._isFunction(a[0]))b.request.params.push(a.shift());return this._isFunction(a[0])?(b.success=a[0],b.scope=a[1]):(b.success=a[0].success,b.failure=a[0].failure,b.callback=a[0].callback,b.scope=a[0].scope),b.success=b.success||function(){return},b.failure=b.failure||function(){return},b.callback=b.callback||function(){return},b},_isFunction:function(a){return Object.prototype.toString.apply(a)==="[object Function]"},_doJsonPost:function(a,b,c){var d=new XMLHttpRequest;d.open("POST",a,!0),d.setRequestHeader("Content-Type","application/json"),d.onreadystatechange=function(){if(d.readyState!==4)return;var a=d.getResponseHeader("Content-Type");d.status!==200?c(!1,'Expected HTTP response "200 OK", found "'+d.status+" "+d.statusText+'"'):a.indexOf("application/json")!==0?c(!1,'Expected JSON encoded response, found "'+a+'"'):c(!0,JSON.parse(this.responseText))},d.send(JSON.stringify(b))}}